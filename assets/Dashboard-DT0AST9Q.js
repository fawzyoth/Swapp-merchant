import{u as q,r as c,s as d,j as e,L as x}from"./index-ByG6RqwF.js";import{M as j,P as u,U as A}from"./MerchantLayout-CNLtqHQt.js";import{C as L}from"./clock-CuIahUSk.js";import{C as g}from"./check-circle-ZzgtH91B.js";import{X as V}from"./x-circle-Dai8aMFp.js";import{B as p}from"./bar-chart-3-BK4ApPHu.js";import"./store-BWwWvJXL.js";function $(){const f=q(),[a,N]=c.useState({total:0,pending:0,validated:0,rejected:0,completed:0,validationRate:0}),[m,b]=c.useState([]),[v,w]=c.useState(!0);c.useEffect(()=>{y(),S()},[]);const y=async()=>{const{data:{session:t}}=await d.auth.getSession();t||f("/merchant/login")},S=async()=>{try{const{data:{session:t}}=await d.auth.getSession();if(!t)return;const{data:n}=await d.from("merchants").select("id").eq("email",t.user.email).maybeSingle();if(!n)return;const{data:l}=await d.from("exchanges").select("status, reason").eq("merchant_id",n.id);if(l){const i=l.length,C=l.filter(s=>s.status==="pending").length,h=l.filter(s=>s.status==="validated"||s.status==="preparing"||s.status==="in_transit"||s.status==="completed").length,R=l.filter(s=>s.status==="rejected").length,k=l.filter(s=>s.status==="completed").length,E=i>0?Math.round(h/i*100):0;N({total:i,pending:C,validated:h,rejected:R,completed:k,validationRate:E});const r={};l.forEach(s=>{r[s.reason]=(r[s.reason]||0)+1});const M=Object.entries(r).map(([s,o])=>({reason:s,count:o})).sort((s,o)=>o.count-s.count).slice(0,5);b(M)}}catch(t){console.error("Error fetching stats:",t)}finally{w(!1)}};return v?e.jsx(j,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-sky-600"})})}):e.jsx(j,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Vue d'ensemble"}),e.jsx("p",{className:"text-slate-600",children:"Statistiques et métriques de vos échanges"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(u,{className:"w-6 h-6 text-blue-600"})}),e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:a.total})]}),e.jsx("h3",{className:"text-slate-600 text-sm",children:"Total des échanges"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(L,{className:"w-6 h-6 text-yellow-600"})}),e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:a.pending})]}),e.jsx("h3",{className:"text-slate-600 text-sm",children:"En attente"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-emerald-100 rounded-lg",children:e.jsx(g,{className:"w-6 h-6 text-emerald-600"})}),e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:a.validated})]}),e.jsx("h3",{className:"text-slate-600 text-sm",children:"Validés"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(V,{className:"w-6 h-6 text-red-600"})}),e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:a.rejected})]}),e.jsx("h3",{className:"text-slate-600 text-sm",children:"Rejetés"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-4",children:"Taux de validation"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-4",children:e.jsx("div",{className:"bg-emerald-600 h-4 rounded-full transition-all",style:{width:`${a.validationRate}%`}})})}),e.jsxs("span",{className:"text-2xl font-bold text-slate-900",children:[a.validationRate,"%"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-4",children:"Échanges complétés"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{className:"w-12 h-12 text-green-600"}),e.jsx("span",{className:"text-3xl font-bold text-slate-900",children:a.completed})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(p,{className:"w-5 h-5"}),"Raisons d'échange principales"]}),m.length>0?e.jsx("div",{className:"space-y-3",children:m.map((t,n)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-slate-700",children:t.reason}),e.jsx("span",{className:"font-medium text-slate-900",children:t.count})]}),e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-2",children:e.jsx("div",{className:"bg-sky-600 h-2 rounded-full",style:{width:`${t.count/a.total*100}%`}})})]},n))}):e.jsx("p",{className:"text-slate-600 text-center py-8",children:"Aucune donnée disponible"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-4",children:"Accès rapide"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(x,{to:"/merchant/exchanges",className:"flex items-center gap-3 p-4 bg-slate-50 hover:bg-slate-100 rounded-lg transition-colors",children:[e.jsx(u,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-900",children:"Gérer les échanges"})]}),e.jsxs(x,{to:"/merchant/clients",className:"flex items-center gap-3 p-4 bg-slate-50 hover:bg-slate-100 rounded-lg transition-colors",children:[e.jsx(A,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-900",children:"Voir les clients"})]}),e.jsxs(x,{to:"/merchant/simulation",className:"flex items-center gap-3 p-4 bg-slate-50 hover:bg-slate-100 rounded-lg transition-colors",children:[e.jsx(p,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-900",children:"Mode simulation"})]})]})]})]})]})})}export{$ as default};
