import{u as v,r as n,j as e,s as t}from"./index-ByG6RqwF.js";import{A as y}from"./arrow-left-BKQ07c9T.js";import{S as j}from"./store-BWwWvJXL.js";function C(){const l=v(),[h,x]=n.useState(""),[p,b]=n.useState(""),[c,m]=n.useState(!1),[f,d]=n.useState("");n.useEffect(()=>{(async()=>{await t.auth.signOut()})()},[]);const g=async s=>{s.preventDefault(),m(!0),d("");try{const{data:r,error:a}=await t.auth.signInWithPassword({email:h,password:p});if(a)throw a;if(r.user){const{data:o}=await t.from("delivery_persons").select("id").eq("email",r.user.email).maybeSingle();if(o)throw await t.auth.signOut(),new Error("Ce compte est un compte livreur. Veuillez utiliser le portail livreur.");const{data:i,error:u}=await t.from("merchants").select("id").eq("email",r.user.email).maybeSingle();if(u||!i)throw await t.auth.signOut(),new Error("Compte e-commerçant non trouvé. Veuillez utiliser le bon portail de connexion.");l("/merchant/dashboard")}}catch(r){d(r.message||"Erreur de connexion")}finally{m(!1)}},w=async()=>{x("demo@merchant.com"),b("demo123456"),m(!0),d("");try{let{data:s,error:r}=await t.auth.signInWithPassword({email:"demo@merchant.com",password:"demo123456"});if(r&&r.message.includes("Invalid login credentials")){const{data:a,error:o}=await t.auth.signUp({email:"demo@merchant.com",password:"demo123456",options:{data:{name:"Boutique Demo",phone:"+216 70 000 000"}}});if(o)throw o;if(a.user){const i="11111111-1111-1111-1111-111111111111",{error:u}=await t.from("merchants").update({id:a.user.id}).eq("id",i);u&&await t.from("merchants").insert({id:a.user.id,email:"demo@merchant.com",name:"Boutique Demo",phone:"+216 70 000 000"}),l("/merchant/dashboard");return}}else if(r)throw r;if(s!=null&&s.user){const{data:a}=await t.from("delivery_persons").select("id").eq("email",s.user.email).maybeSingle();if(a)throw await t.auth.signOut(),new Error("Ce compte est un compte livreur.");const{data:o,error:i}=await t.from("merchants").select("id").eq("email",s.user.email).maybeSingle();if(i||!o)throw await t.auth.signOut(),new Error("Compte e-commerçant non trouvé.");l("/merchant/dashboard")}}catch(s){d(s.message||"Erreur de connexion. Veuillez créer le compte via Supabase Dashboard.")}finally{m(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-sky-50 via-white to-emerald-50",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>l("/"),className:"flex items-center text-slate-600 hover:text-slate-900 mb-6",children:[e.jsx(y,{className:"w-5 h-5 mr-2"}),"Retour à l'accueil"]}),e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-sky-100 rounded-full mb-4",children:e.jsx(j,{className:"w-8 h-8 text-sky-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Connexion E-Commerçant"}),e.jsx("p",{className:"text-slate-600",children:"Accédez à votre tableau de bord"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[f&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:f}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email"}),e.jsx("input",{type:"email",required:!0,value:h,onChange:s=>x(s.target.value),placeholder:"votre@email.com",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Mot de passe"}),e.jsx("input",{type:"password",required:!0,value:p,onChange:s=>b(s.target.value),placeholder:"••••••••",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500"})]}),e.jsx("button",{type:"submit",disabled:c,className:"w-full py-3 bg-sky-600 hover:bg-sky-700 disabled:bg-slate-300 text-white rounded-lg font-medium transition-colors",children:c?"Connexion...":"Se connecter"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-slate-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-slate-500",children:"ou"})})]}),e.jsx("button",{onClick:w,disabled:c,className:"w-full mt-4 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg font-medium transition-colors",children:"Connexion Demo"})]}),e.jsxs("div",{className:"mt-6 p-4 bg-sky-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-sky-800 font-medium mb-2",children:"Compte de démonstration:"}),e.jsxs("p",{className:"text-xs text-sky-700",children:["Email: demo@merchant.com",e.jsx("br",{}),"Mot de passe: demo123456"]})]})]})]})]})})}export{C as default};
