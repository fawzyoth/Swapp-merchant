import{u as N,r as a,s as n,j as e,S as y}from"./index-ByG6RqwF.js";import{M as m}from"./MerchantLayout-CNLtqHQt.js";import{c as x}from"./store-BWwWvJXL.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=x("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=x("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);function _(){N();const[h,p]=a.useState([]),[t,o]=a.useState(""),[r,u]=a.useState(""),[g,j]=a.useState(!0),[l,i]=a.useState(!1);a.useEffect(()=>{c()},[]);const c=async()=>{try{const{data:s}=await n.from("exchanges").select("*").order("created_at",{ascending:!1});p(s||[])}catch(s){console.error("Error fetching exchanges:",s)}finally{j(!1)}},b=async()=>{if(!t||!r){alert("Veuillez sélectionner un échange et un statut");return}i(!0);try{await n.from("exchanges").update({status:r,updated_at:new Date().toISOString()}).eq("id",t),await n.from("status_history").insert({exchange_id:t,status:r}),alert("Statut mis à jour avec succès"),c(),o(""),u("")}catch(s){console.error("Error updating status:",s),alert("Erreur lors de la mise à jour")}finally{i(!1)}},f=async()=>{if(!t){alert("Veuillez sélectionner un échange");return}i(!0);const s=["validated","preparing","in_transit","completed"];try{for(const d of s)await n.from("exchanges").update({status:d,updated_at:new Date().toISOString()}).eq("id",t),await n.from("status_history").insert({exchange_id:t,status:d}),await new Promise(v=>setTimeout(v,500));alert("Workflow complet simulé avec succès"),c(),o("")}catch(d){console.error("Error simulating workflow:",d),alert("Erreur lors de la simulation")}finally{i(!1)}};return g?e.jsx(m,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-sky-600"})})}):e.jsx(m,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Mode Simulation"}),e.jsx("p",{className:"text-slate-600",children:"Testez les différents statuts d'échanges"})]}),e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-4",children:"Mettre à jour un statut"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Sélectionner un échange"}),e.jsxs("select",{value:t,onChange:s=>o(s.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500",children:[e.jsx("option",{value:"",children:"-- Choisir un échange --"}),h.map(s=>e.jsxs("option",{value:s.id,children:[s.exchange_code," - ",s.client_name," (",y[s.status],")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nouveau statut"}),e.jsxs("select",{value:r,onChange:s=>u(s.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500",children:[e.jsx("option",{value:"",children:"-- Choisir un statut --"}),e.jsx("option",{value:"pending",children:"En attente"}),e.jsx("option",{value:"validated",children:"Validé"}),e.jsx("option",{value:"preparing",children:"Préparation mini-dépôt"}),e.jsx("option",{value:"in_transit",children:"En route"}),e.jsx("option",{value:"completed",children:"Échange effectué"}),e.jsx("option",{value:"returned",children:"Produit retourné"}),e.jsx("option",{value:"rejected",children:"Rejeté"})]})]}),e.jsxs("button",{onClick:b,disabled:l||!t||!r,className:"w-full flex items-center justify-center gap-2 py-3 bg-sky-600 hover:bg-sky-700 disabled:bg-slate-300 text-white rounded-lg font-medium transition-colors",children:[e.jsx(S,{className:`w-5 h-5 ${l?"animate-spin":""}`}),l?"Mise à jour...":"Mettre à jour le statut"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-4",children:"Simuler un workflow complet"}),e.jsx("p",{className:"text-sm text-slate-600 mb-4",children:"Cette action simulera automatiquement tous les statuts de l'échange sélectionné: Validé → Préparation → En route → Complété"}),e.jsxs("button",{onClick:f,disabled:l||!t,className:"w-full flex items-center justify-center gap-2 py-3 bg-emerald-600 hover:bg-emerald-700 disabled:bg-slate-300 text-white rounded-lg font-medium transition-colors",children:[e.jsx(w,{className:"w-5 h-5"}),l?"Simulation en cours...":"Lancer la simulation complète"]})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-6",children:[e.jsx("h4",{className:"font-bold text-amber-900 mb-2",children:"Note importante"}),e.jsxs("ul",{className:"text-sm text-amber-800 space-y-1",children:[e.jsx("li",{children:"• Ce mode est destiné aux tests uniquement"}),e.jsx("li",{children:"• Les changements de statut sont irréversibles"}),e.jsx("li",{children:"• Utilisez des échanges de test pour vos simulations"}),e.jsx("li",{children:"• Les notifications et l'historique seront mis à jour"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-4",children:"États disponibles"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("p",{className:"font-medium text-yellow-900",children:"En attente"}),e.jsx("p",{className:"text-yellow-700 text-xs",children:"Demande soumise"})]}),e.jsxs("div",{className:"p-3 bg-emerald-50 border border-emerald-200 rounded-lg",children:[e.jsx("p",{className:"font-medium text-emerald-900",children:"Validé"}),e.jsx("p",{className:"text-emerald-700 text-xs",children:"Échange accepté"})]}),e.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Préparation"}),e.jsx("p",{className:"text-blue-700 text-xs",children:"Au mini-dépôt"})]}),e.jsxs("div",{className:"p-3 bg-indigo-50 border border-indigo-200 rounded-lg",children:[e.jsx("p",{className:"font-medium text-indigo-900",children:"En route"}),e.jsx("p",{className:"text-indigo-700 text-xs",children:"Vers le client"})]}),e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("p",{className:"font-medium text-green-900",children:"Complété"}),e.jsx("p",{className:"text-green-700 text-xs",children:"Échange finalisé"})]}),e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("p",{className:"font-medium text-red-900",children:"Rejeté"}),e.jsx("p",{className:"text-red-700 text-xs",children:"Demande refusée"})]})]})]})]})]})})}export{_ as default};
